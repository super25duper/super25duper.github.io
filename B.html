<!DOCTYPE html>
<html lang="he">
<head>
  <meta charset="UTF-8">
  <title>转专转 驻专</title>
  <link rel="icon" href=".icons/forum-192.png" type="image/png">

  <style>
    body {
      font-family: Arial;
      direction: rtl;
      text-align: center;
      margin-top: 40px;
    }
    input, button {
      padding: 8px;
      margin: 6px;
      width: 220px;
    }
    #appBox {
      display: none;
    }
  </style>
</head>
<body>

<h2>注专转 转专转</h2>

<!-- 转专转 -->
<div id="loginBox">
  <h3>转专转</h3>
  <input id="username" placeholder="砖 砖转砖">
  <input id="password" type="password" placeholder="住住">
  <br>
  <button id="login">转专</button>
</div>

<!-- 驻拽爪 -->
<div id="appBox">
  <p id="userInfo"></p>
  <button id="enable">驻注 转专转</button>
  <br><br>
  <button id="logout">转转拽</button>
</div>

<!-- Firebase SDKs -->
<script src="https://www.gstatic.com/firebasejs/8.10.0/firebase-app.js"></script>
<script src="https://www.gstatic.com/firebasejs/8.10.0/firebase-auth.js"></script>
<script src="https://www.gstatic.com/firebasejs/8.10.0/firebase-database.js"></script>
<script src="https://www.gstatic.com/firebasejs/8.10.0/firebase-messaging.js"></script>

<!-- firebaseconfig.js 砖 -->
<script src="firebaseConfig.js"></script>

<script>
  // Firebase services
  const auth = firebase.auth();
  const messaging = firebase.messaging();

  // 砖 爪 驻 转专转
  auth.onAuthStateChanged(user => {
    if (user) {
      document.getElementById("loginBox").style.display = "none";
      document.getElementById("appBox").style.display = "block";
      const name = user.email.split("@")[0];
      document.getElementById("userInfo").innerText =
        "专 志" + name;
    } else {
      document.getElementById("loginBox").style.display = "block";
      document.getElementById("appBox").style.display = "none";
    }
  });

  // 转专转
  document.getElementById("login").onclick = async () => {
    const username = document.getElementById("username").value.trim();
    const password = document.getElementById("password").value;

    if (!username || !password) {
      alert("  砖 砖转砖 住住");
      return;
    }

    const email = username + "@forum.local";

    try {
      await auth.signInWithEmailAndPassword(email, password);
    } catch (err) {
      alert("砖转 转专转");
      console.error(err);
    }
  };

  // 转转拽转
  document.getElementById("logout").onclick = () => {
    auth.signOut();
  };

  // 驻注转 转专转
  document.getElementById("enable").onclick = async () => {
    const user = auth.currentUser;
    if (!user) {
      alert(" 专");
      return;
    }

    if (!("Notification" in window)) {
      alert("驻驻  转 转专转");
      return;
    }

    const permission = await Notification.requestPermission();
    if (permission !== "granted") {
      alert(" 专砖 转专转");
      return;
    }

    const registration = await navigator.serviceWorker.register(
      "/firebase-messaging-sw.js"
    );

    const token = await messaging.getToken({
      vapidKey: "BCEbyZAb3xoWiC4QBcKLv0iZmWLxrJRcYyZD6B4ASDmYCeYdySqMwSGF534Y2v-3eBg5S8StsSb5tB4qTRYkXRk",
      serviceWorkerRegistration: registration
    });

    console.log("FCM TOKEN:", token);

    await db.ref(`userTokens/${user.uid}/tokens/${token}`).set({
      createdAt: Date.now()
    });

    alert("转专转 驻注 爪 ");
  };
</script>

</body>
</html>
