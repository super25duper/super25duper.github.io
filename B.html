<!DOCTYPE html>
<html lang="he">
<head>
  <meta charset="UTF-8">
  <title>התראות פורום</title>
</head>
<body>

<h2>אתר התראות</h2>
<button id="enable">הפעל התראות</button>

<!-- Firebase core -->
<script src="https://www.gstatic.com/firebasejs/8.10.0/firebase-app.js"></script>
<script src="https://www.gstatic.com/firebasejs/8.10.0/firebase-database.js"></script>
<script src="https://www.gstatic.com/firebasejs/8.10.0/firebase-messaging.js"></script>

<!-- config שלך -->
<script src="firebaseConfig.js"></script>
<script>
  const messaging = firebase.messaging();

  document.getElementById("enable").onclick = async () => {

    // בדיקות בסיס
    if (!("Notification" in window)) {
      alert("הדפדפן לא תומך בהתראות");
      return;
    }

    if (!window.isSecureContext) {
      alert("התראות עובדות רק ב-HTTPS");
      return;
    }

    console.log("Current permission:", Notification.permission);

    // בקשת הרשאה
    const permission = await Notification.requestPermission();

    console.log("Permission result:", permission);

    if (permission !== "granted") {
      alert("ההרשאה לא אושרה");
      return;
    }

    // רישום Service Worker
    const registration = await navigator.serviceWorker.register(
      "/firebase-messaging-sw.js"
    );

    // קבלת FCM token
    const token = await messaging.getToken({
      vapidKey: "VAPID_PUBLIC_KEY_אמיתי",
      serviceWorkerRegistration: registration
    });

    console.log("FCM TOKEN:", token);

    alert("התראות הופעלו בהצלחה");
  };
</script>

</body>
</html>
