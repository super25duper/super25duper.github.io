<!DOCTYPE html>
<html lang="he">
<head>
  <meta charset="UTF-8">
  <title>התראות פורום</title>
</head>
<body>

<h2>אתר התראות</h2>
<button id="enable">הפעל התראות</button>

<!-- Firebase core -->
<script src="https://www.gstatic.com/firebasejs/8.10.0/firebase-app.js"></script>
<script src="https://www.gstatic.com/firebasejs/8.10.0/firebase-database.js"></script>
<script src="https://www.gstatic.com/firebasejs/8.10.0/firebase-messaging.js"></script>

<!-- config שלך -->
<script src="./firebaseconfig.js"></script>

<script>
  const messaging = firebase.messaging();

  document.getElementById("enable").onclick = async () => {

    // 1. בקשת הרשאה
    const permission = await Notification.requestPermission();
    if (permission !== "granted") {
      alert("המשתמש לא אישר התראות");
      return;
    }

    // 2. רישום Service Worker
    const registration = await navigator.serviceWorker.register(
      "/firebase-messaging-sw.js"
    );

    // 3. קבלת FCM token
    const token = await messaging.getToken({
      vapidKey: "כאן_ה-VAPID_PUBLIC_KEY_מ-Firebase",
      serviceWorkerRegistration: registration
    });

    if (!token) {
      alert("לא התקבל token");
      return;
    }

    console.log("FCM TOKEN:", token);
    alert("התראות הופעלו בהצלחה");

    // 4. שמירת token ב-DB (זמני – לשלב בדיקה)
    db.ref("tokens/testUser").set({
      token: token,
      createdAt: Date.now()
    });
  };
</script>

</body>
</html>